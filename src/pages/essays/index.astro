---
import { MediumZoom } from 'astro-pure/advanced'
import { Icon } from 'astro-pure/user'
import BoardLayout from '@/layouts/BoardLayout.astro'
import TextBackground from '@/components/custom/TextBackground.astro'
---

<BoardLayout title='Essays' comment>
  <div style='text-align:center; line-height:1.8; padding:20px 0; position:relative;'>
    <!-- 背景文字 -->
    <TextBackground variant='words' />

    <h2 style='font-size:26px; margin-bottom:12px;'>Essays</h2>
    <p style='font-size:16px; color:hsl(var(--foreground));'>我的Misskey动态</p>
  </div>

  <div class='mt-4 border-t pt-4'>
    <div class='flex justify-center'>
      <iframe src="https://hub.imikufans.com/embed/user-timeline/ahe8iuwty5zv05sz?header=false&maxHeight=700" data-misskey-embed-id="v1_ahelkm8ghe" loading="lazy" referrerpolicy="strict-origin-when-cross-origin" style="border: none; width: 100%; max-width: 500px; height: 300px;"></iframe>
    </div>
  </div>

  <script defer src="https://hub.imikufans.com/embed.js"></script>

  <script is:inline>
    // 发送主题信息到Misskey嵌入
    function sendThemeToMisskeyEmbed() {
      const iframe = document.querySelector('iframe[data-misskey-embed-id]');
      if (!iframe) return;
      
      const isDark = document.documentElement.classList.contains('dark');
      const theme = isDark ? 'dark' : 'light';
      
      iframe.contentWindow?.postMessage({
        type: 'misskey:embedParent:themeChange',
        payload: {
          theme: theme
        }
      }, '*');
    }

    // 监听主题变化
    function setupThemeListener() {
      // 初始发送主题
      sendThemeToMisskeyEmbed();
      
      // 监听localStorage变化
      window.addEventListener('storage', function(e) {
        if (e.key === 'theme') {
          sendThemeToMisskeyEmbed();
        }
      });
      
      // 监听文档类变化
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'class') {
            sendThemeToMisskeyEmbed();
          }
        });
      });
      
      observer.observe(document.documentElement, { attributes: true });
    }

    // 页面加载完成后设置监听器
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupThemeListener);
    } else {
      setupThemeListener();
    }
  </script>

  <MediumZoom />
</BoardLayout>